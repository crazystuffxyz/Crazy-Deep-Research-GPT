import axios from"axios";import TurndownService from"turndown";import{extractArticleText}from"./extractFromUrl.js";import{getMullvadLetaResults}from"./mullvadLetaClient.js";const turndownService=new TurndownService({headingStyle:"atx",hr:"---",bulletListMarker:"*",codeBlockStyle:"fenced",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",preformattedCode:!0});async function getFetchResults(e){try{const r=await extractArticleText(e);if(!r||"string"!=typeof r){return`Error: Could not extract readable HTML content from ${e}.`}if(r.startsWith("Error:"))return r;return turndownService.turndown(r).trim()}catch(r){let t=`[getFetchResults] Unexpected error processing URL ${e}: `;return r instanceof Error?(t+=r.message,axios.isAxiosError(r)&&(t+=` (Axios Error - Status: ${r.response?.status||"N/A"}`,"ECONNABORTED"===r.code&&(t+=", Timeout"),t+=")")):t+="An unknown error occurred.",console.error(t,r.stack),`Error: Failed to fetch or process content from ${e}. Details: ${r instanceof Error?r.message:"Unknown error"}`}}async function getSearchResults(e){try{return await getMullvadLetaResults(e,5,1,100,"google")}catch(r){let t=`[getSearchResults] Error fetching search results for query "${e}": `;return r instanceof Error?t+=r.message:t+="An unknown error occurred.",console.error(t,r.stack),null}}turndownService.addRule("strikethrough",{filter:["del","s","strike"],replacement:function(e){return"~"+e+"~"}}),turndownService.addRule("images",{filter:"img",replacement:function(e,r){const t=r.getAttribute("alt")||"",o=r.getAttribute("src")||"",n=r.getAttribute("title")||"";if(!o)return"";return`![${t}](${o}${n?` "${n}"`:""})`}}),turndownService.keep(["table","thead","tbody","tr","th","td"]);export{getFetchResults,getSearchResults};