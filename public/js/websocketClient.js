import{handleWSMessage}from"./uiManager.js";let ws;export function connectWebSocket(e,o,n,t){const s="https:"===window.location.protocol?"wss://":"ws://";ws=new WebSocket(s+window.location.host),ws.onopen=()=>{if(console.log("WebSocket connected."),e()&&o()){const e=o(),s=e.dataset.messageId;n(e,{thinking:(e.querySelector(".thinking-log-container")?.textContent||"")+"\nWarning: Connection re-established. Previous response may be incomplete.",isComplete:!0},s),t(!1)}},ws.onmessage=e=>handleWSMessage(e,o,n,t),ws.onerror=e=>console.error("WebSocket error:",e),ws.onclose=()=>{if(console.log("WebSocket closed. Reconnecting in 3s..."),e()&&o()){const e=o(),t=e.dataset.messageId;n(e,{thinking:(e.querySelector(".thinking-log-container")?.textContent||"")+"\nConnection lost. Attempting to reconnect..."},t)}setTimeout((()=>connectWebSocket(e,o,n,t)),3e3)}}export function getWs(){return ws}export function sendWsMessage(e){return ws&&ws.readyState===WebSocket.OPEN?(ws.send(JSON.stringify(e)),Promise.resolve()):(console.error("WebSocket not open. Cannot send message."),Promise.reject(new Error("WebSocket not open.")))}